# 取得所有 TCP 連線的本地 port，並加上 Protocol 標示
$tcpPorts = Get-NetTCPConnection | Select-Object @{Name="Protocol";Expression={"TCP"}}, @{Name="Port";Expression={$_.LocalPort}}

# 取得所有 UDP 端點的本地 port，並加上 Protocol 標示
$udpPorts = Get-NetUDPEndpoint | Select-Object @{Name="Protocol";Expression={"UDP"}}, @{Name="Port";Expression={$_.LocalPort}}

# 合併，依 Protocol 和 Port 排序，去重
$allPorts = $tcpPorts + $udpPorts | Sort-Object Protocol, Port -Unique

# 印出結果
Write-Host "系統目前被使用的 TCP 和 UDP port 如下："
foreach ($p in $allPorts) {
    Write-Host "$($p.Protocol) : $($p.Port)"
}